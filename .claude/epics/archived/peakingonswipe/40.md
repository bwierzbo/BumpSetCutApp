---
name: Create FrameExtractor Service with LRU Caching
status: open
created: 2025-09-17T00:31:13Z
updated: 2025-09-17T00:37:00Z
github: https://github.com/bwierzbo/BumpSetCutApp/issues/40
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Create FrameExtractor Service with LRU Caching

## Description

Implement a lightweight frame extraction service using AVFoundation's `AVAssetImageGenerator` to extract static frames from rally videos on-demand. Include LRU caching to optimize performance for recently viewed frames while maintaining strict memory limits.

## Acceptance Criteria

- [ ] FrameExtractor service extracts first frame (at 0.1 seconds) from video URLs
- [ ] Frame extraction completes within 100ms for typical rally videos
- [ ] LRU cache implementation with maximum 5 frames and automatic eviction
- [ ] Async/await pattern using Swift 6 concurrency for non-blocking extraction
- [ ] Graceful error handling for corrupted or inaccessible videos
- [ ] Memory usage stays under 10MB peak for frame extraction operations
- [ ] Proper resource cleanup and disposal patterns

## Technical Details

**Implementation Location:**
- Create new file: `BumpSetCut/Infrastructure/Media/FrameExtractor.swift`
- Add to Infrastructure layer following clean architecture

**Key Components:**
- `FrameExtractor` class with async frame extraction methods
- `FrameCache` struct implementing LRU eviction policy
- Error handling for various video access scenarios
- Background queue processing to maintain UI responsiveness

**Code Considerations:**
- Use `AVAssetImageGenerator` with `requestImage(for:completionHandler:)`
- Extract frame at 0.1 seconds to avoid potential black first frames
- Implement cache using Dictionary + linked list for O(1) operations
- Add memory pressure monitoring for automatic cache clearing

## Dependencies

- [ ] AVFoundation framework access
- [ ] Existing video URL and metadata infrastructure
- [ ] Swift 6 concurrency patterns from current codebase

## Effort Estimate

- **Size**: M
- **Hours**: 16-20 hours
- **Parallel**: true (independent foundation work)

## Definition of Done

- [ ] FrameExtractor service implemented with full error handling
- [ ] LRU cache working with automatic eviction and memory management
- [ ] Unit tests covering extraction, caching, and error scenarios
- [ ] Performance validation meeting <100ms and <10MB requirements
- [ ] Code follows existing infrastructure layer patterns
- [ ] Integration ready for gesture system consumption
