---
name: Create RallyPlayerView with Navigation
status: completed
created: 2025-09-13T15:19:39Z
updated: 2025-09-13T16:20:00Z
github: [Will be updated when synced to GitHub]
depends_on: [003, 004]
parallel: true
conflicts_with: []
---

# Task: Create RallyPlayerView with Navigation

## Description
Create a new SwiftUI view for rally-by-rally navigation that loads metadata and provides seamless jumping between rally segments. This view will use AVPlayer seek functionality and gesture-based navigation for an intuitive user experience.

## Acceptance Criteria
- [x] RallyPlayerView loads ProcessingMetadata for a given video
- [x] Rally-by-rally navigation with swipe gestures (left/right)
- [x] AVPlayer integration with precise seek-to-rally functionality
- [x] Rally progress indicator showing current rally position
- [x] Graceful handling of videos without metadata (fallback to normal playback)
- [x] Performance optimization for rapid rally switching

## Technical Details
- **Location**: `BumpSetCut/Presentation/Views/RallyPlayerView.swift` (new file)
- **Implementation approach**:
  - SwiftUI view with AVPlayer integration
  - Use SwiftUI gesture recognizers for navigation
  - Lazy loading of rally segments for performance
- **Key considerations**:
  - AVPlayer seek precision (target <200ms rally switching)
  - Memory management for video player state
  - Consistent UI patterns with existing video playback
- **Files affected**: New RallyPlayerView, integration with existing video player components

## Dependencies
- [ ] Task 003: VideoMetadata extension with hasMetadata property
- [ ] Task 004: VideoProcessor metadata generation
- [ ] Review existing VideoPlayerView for integration patterns

## Effort Estimate
- Size: M
- Hours: 14 hours
- Parallel: true (UI component independent of other parallel tasks)

## Definition of Done
- [x] RallyPlayerView implemented with full navigation functionality
- [x] Gesture-based rally switching working smoothly
- [x] AVPlayer seek performance optimized for rally jumping
- [x] UI matches existing BumpSetCut design patterns
- [x] Testing covers various rally count scenarios
- [x] Performance benchmarks meet <200ms switching target

## Implementation Summary
Successfully implemented RallyPlayerView with comprehensive rally-by-rally navigation:

### Key Features Delivered:
- **AVPlayer Integration**: Precise seeking with CMTime accuracy and performance monitoring
- **Gesture Navigation**: Swipe left/right with animation and visual feedback
- **Rally Progress Indicator**: Interactive progress bar showing rally positions and quality
- **Error Handling**: Graceful fallback for videos without metadata
- **Performance Optimization**: <200ms seek target with real-time performance tracking
- **UI Consistency**: Matches existing BumpSetCut design patterns and color scheme

### Files Created:
- `/BumpSetCut/Presentation/Views/RallyPlayerView.swift` (572 lines)
- `/BumpSetCutTests/Presentation/Views/RallyPlayerViewTests.swift` (252 lines)

### Technical Highlights:
- Uses MetadataStore service for ProcessingMetadata loading
- CMTime precision for video seeking with zero tolerance
- SwiftUI Canvas-ready architecture for future overlay integration
- Comprehensive test coverage for various rally count scenarios
- Performance tracking with visual indicators
- Memory-efficient cleanup of AVPlayer resources