---
epic: debugdashboard
number: 005
title: Export Functionality - JSON/CSV Data Export
status: closed
created: 2025-09-03T16:52:09Z
depends_on: [002, 003]
parallel: true
conflicts_with: []
effort: M
estimate_days: 1.5
batch: data-testing
---

# Task 005: Export Functionality - JSON/CSV Data Export

## Overview

Implement JSON and CSV export features in DebugDashboardView with proper file handling and data validation. Add export buttons to the dashboard UI and ensure format compliance for external analysis tools. This task enables users to extract debug data for offline analysis and sharing with development teams.

## Context

This task depends on Task 002's debug data collection and Task 003's dashboard presentation. It adds export capabilities to the existing debug dashboard, allowing users to save debug data in standard formats for analysis in external tools like Excel, data analysis software, or development environments.

## Technical Details

**Files to Modify:**
- `Presentation/Views/DebugDashboardView.swift` - Add export UI and functionality
- `Infrastructure/Services/TrajectoryDebugger.swift` - Add export format methods
- `Domain/Models/DebugDataExporter.swift` - New service for export operations

**Export Architecture:**

**1. Export UI Integration**
```swift
// Add export section to DebugDashboardView
struct DebugExportSection: View {
    let debugger: TrajectoryDebugger
    @State private var showingExportAlert = false
    @State private var exportFormat: ExportFormat = .json
    @State private var isExporting = false
    
    var body: some View {
        Section("Export Debug Data") {
            HStack {
                Picker("Format", selection: $exportFormat) {
                    Text("JSON").tag(ExportFormat.json)
                    Text("CSV").tag(ExportFormat.csv)
                }
                .pickerStyle(SegmentedPickerStyle())
                
                Spacer()
                
                Button("Export") {
                    exportDebugData()
                }
                .disabled(isExporting)
                .buttonStyle(.borderedProminent)
            }
        }
    }
    
    private func exportDebugData() {
        Task {
            await performExport()
        }
    }
}
```

**2. DebugDataExporter Service**
```swift
// Dedicated service for export operations
class DebugDataExporter {
    enum ExportFormat: CaseIterable {
        case json, csv
        
        var fileExtension: String {
            switch self {
            case .json: return "json"
            case .csv: return "csv"
            }
        }
        
        var mimeType: String {
            switch self {
            case .json: return "application/json"
            case .csv: return "text/csv"
            }
        }
    }
    
    // Export debug data in specified format
    func exportDebugData(
        _ debugger: TrajectoryDebugger,
        format: ExportFormat,
        filename: String? = nil
    ) async throws -> URL {
        
        let exportData = try await prepareExportData(debugger)
        let filename = filename ?? generateFilename(format: format)
        
        switch format {
        case .json:
            return try await exportAsJSON(exportData, filename: filename)
        case .csv:
            return try await exportAsCSV(exportData, filename: filename)
        }
    }
    
    // Generate timestamped filename
    private func generateFilename(format: ExportFormat) -> String {
        let timestamp = DateFormatter.exportTimestamp.string(from: Date())
        return "debug_data_\(timestamp).\(format.fileExtension)"
    }
}
```

**3. Export Data Structures**
```swift
// Comprehensive export data structure
struct ExportableDebugData: Codable {
    let metadata: ExportMetadata
    let trajectoryAnalysis: TrajectoryExportData
    let frameAnalysis: [FrameExportData]
    let performanceMetrics: PerformanceExportData
    let processingParameters: ProcessingParametersExport
    
    struct ExportMetadata: Codable {
        let exportDate: Date
        let sessionId: UUID
        let videoId: UUID
        let appVersion: String
        let processingDuration: TimeInterval
        let totalFrames: Int
    }
}

// CSV-specific flattened structure
struct CSVExportRow: Codable {
    let frameNumber: Int
    let timestamp: Double
    let ballX: Double?
    let ballY: Double?
    let ballConfidence: Double?
    let playerCount: Int
    let courtDetected: Bool
    let processingTimeMs: Double
    // Additional fields for comprehensive CSV export
}
```

## Export Format Specifications

**JSON Export Format:**
- Complete hierarchical debug data structure
- Includes metadata, timestamps, and processing context
- Compatible with standard JSON analysis tools
- Human-readable formatting with proper indentation
- Includes schema version for future compatibility

**CSV Export Format:**
- Flattened frame-by-frame analysis data
- Headers for all numeric and categorical data
- Compatible with Excel and data analysis tools
- Null value handling for missing measurements
- Timestamp formatting for time-series analysis

## File Handling Architecture

**Export Process:**
1. User selects export format and initiates export
2. DebugDataExporter prepares data in requested format
3. System file picker presented for save location
4. Data written to selected location with proper error handling
5. Success/failure feedback provided to user

**File Management:**
- Temporary files cleaned up after export
- Large dataset streaming for memory efficiency
- Progress indication for large exports
- Proper file permissions and encoding

## Acceptance Criteria

### Export UI Implementation
- [ ] Export section added to DebugDashboardView with format selection
- [ ] Export buttons properly styled and accessible
- [ ] Format picker (JSON/CSV) integrated with segmented control
- [ ] Export progress indication during operation
- [ ] Success/failure alerts with appropriate messaging

### JSON Export Functionality
- [ ] Complete debug data exported in valid JSON format
- [ ] Hierarchical structure preserved with all data fields
- [ ] Proper JSON formatting with indentation for readability
- [ ] Metadata included (export date, session info, app version)
- [ ] File saved with .json extension and correct MIME type

### CSV Export Functionality
- [ ] Frame-by-frame data flattened to CSV format
- [ ] Column headers included for all data fields
- [ ] Numeric data properly formatted for analysis tools
- [ ] Missing values handled consistently (null/empty representation)
- [ ] File saved with .csv extension and correct encoding

### File Handling
- [ ] System file picker integration for save location selection
- [ ] Proper error handling for file system operations
- [ ] Large dataset support without memory issues
- [ ] Temporary file cleanup after export operations
- [ ] File permissions set appropriately for user access

### Data Validation
- [ ] Export data format compliance validated before writing
- [ ] No data corruption during export process
- [ ] Exported files can be opened by standard tools (Excel, text editors, JSON viewers)
- [ ] All critical debug information preserved in export
- [ ] Export process handles edge cases (empty data, invalid states)

## Definition of Done

1. **Export UI Complete**: Dashboard includes functional export controls with format selection
2. **JSON Export Working**: Complete debug data can be exported in valid JSON format
3. **CSV Export Working**: Frame-level data can be exported in analysis-ready CSV format
4. **File Handling Robust**: Export process handles file system operations reliably
5. **Data Validation Implemented**: Export data validated for format compliance
6. **User Experience Polished**: Clear feedback and error handling throughout export process

## Dependencies

**Requires Task 002**: Needs debug data collection working to have data to export
**Requires Task 003**: Needs dashboard UI to integrate export functionality
**Parallel with Task 004**: Can work independently of data persistence
**Enables Task 006**: Provides export functionality for testing validation

## Technical Notes

- Consider chunked export for very large debug data sets
- Implement export cancellation for long-running operations
- Add export format validation before file writing
- Consider compression options for large JSON exports
- Test with various external tools to ensure compatibility
- Add export history/tracking if beneficial for user workflow