---
epic: debugdashboard
number: 002
title: Debug Mode Workflow - VideoProcessor Integration
status: closed
created: 2025-09-03T16:52:09Z
depends_on: [001]
parallel: false
conflicts_with: []
effort: M
estimate_days: 2
batch: core-integration
---

# Task 002: Debug Mode Workflow - VideoProcessor Integration

## Overview

Connect TrajectoryDebugger to VideoProcessor for debug-enabled processing. Implement conditional debugger initialization when debug mode is active and enhance console logging in debug mode. This task creates the core backend functionality for debug data collection.

## Context

This task depends on Task 001's debug toggle UI to determine when debug mode should be activated. It establishes the connection between the existing TrajectoryDebugger backend and the video processing workflow, enabling debug data collection during video analysis.

## Technical Details

**Files to Modify:**
- `Infrastructure/Services/VideoProcessor.swift` - Add debug mode parameter and TrajectoryDebugger integration
- `Presentation/Views/ProcessVideoView.swift` - Pass debug state to VideoProcessor and handle debug data

**Integration Strategy:**

**1. VideoProcessor Enhancement**
```swift
// Add debug parameter to processing method
func processVideo(
    url: URL, 
    settings: ProcessingSettings,
    debugMode: Bool = false
) async throws -> VideoProcessingResult {
    
    // Conditional debugger initialization
    let trajectoryDebugger: TrajectoryDebugger? = debugMode ? TrajectoryDebugger() : nil
    
    // Enhanced logging in debug mode
    if debugMode {
        print("üêõ Debug mode active - comprehensive logging enabled")
        print("üéØ Processing settings: \(settings)")
    }
    
    // Pass debugger through processing pipeline
    let result = try await processWithDebugger(url: url, settings: settings, debugger: trajectoryDebugger)
    
    // Return enhanced result with debug data
    return VideoProcessingResult(
        originalResult: result,
        debugData: trajectoryDebugger?.exportDebugData()
    )
}
```

**2. ProcessVideoView Integration**
```swift
// Pass debug state to processor
let result = try await videoProcessor.processVideo(
    url: selectedVideoURL,
    settings: processingSettings,
    debugMode: isDebugEnabled
)

// Handle debug data availability
if let debugData = result.debugData {
    self.hasDebugData = true
    self.trajectoryDebugger = result.debugger // Store for dashboard
}
```

**3. Enhanced Debug Logging**
- Frame-by-frame processing logs when debug mode active
- Performance timing logs for each processing stage
- Parameter values and intermediate results logging
- Memory usage tracking during processing

## Data Flow Architecture

**Debug Mode Processing Flow:**
1. User enables debug toggle ‚Üí `isDebugEnabled = true`
2. ProcessVideoView calls `processVideo(debugMode: true)`
3. VideoProcessor initializes TrajectoryDebugger
4. Processing pipeline collects debug data through debugger
5. Completed result includes debug data reference
6. ProcessVideoView updates `hasDebugData = true`
7. Debug dashboard becomes accessible

**Error Handling:**
- Debug mode failures isolated from main processing
- Graceful degradation if TrajectoryDebugger initialization fails
- Clear error messages if debug data collection encounters issues
- Main video processing continues even if debug collection fails

## Performance Considerations

**Debug Mode Overhead:**
- Target: <5% processing time increase
- Memory usage monitoring during debug collection
- Conditional logging to minimize string operations in release builds
- Efficient debug data serialization

**Memory Management:**
- Proper cleanup of debug data after dashboard access
- Weak references where appropriate to prevent retain cycles
- Debug data lifecycle tied to video processing session

## Acceptance Criteria

### VideoProcessor Integration
- [ ] VideoProcessor accepts `debugMode: Bool` parameter in processing methods
- [ ] TrajectoryDebugger conditionally initialized only when debug mode active
- [ ] Debug data collected throughout processing pipeline when debugger present
- [ ] VideoProcessingResult enhanced to include optional debug data
- [ ] Processing completes successfully in both debug and normal modes

### Debug Data Collection
- [ ] TrajectoryDebugger collects comprehensive frame-by-frame analysis when active
- [ ] Ball trajectory, player positions, and court detection data captured
- [ ] Performance metrics recorded for each processing stage
- [ ] Debug data properly serialized for storage and dashboard consumption

### ProcessVideoView Integration
- [ ] Debug mode state passed correctly to VideoProcessor
- [ ] `hasDebugData` state updated when debug data available
- [ ] TrajectoryDebugger instance stored for dashboard access
- [ ] Error handling gracefully manages debug mode failures

### Logging Enhancement
- [ ] Enhanced console logging active only in debug mode
- [ ] Frame processing logs include timing and intermediate results
- [ ] Parameter values logged for debugging purposes
- [ ] Memory usage tracking during debug sessions

### Performance Validation
- [ ] Debug mode overhead measured and documented (<5% target)
- [ ] Memory usage remains stable during debug data collection
- [ ] Normal processing mode unaffected by debug code additions
- [ ] No memory leaks in debug data collection lifecycle

## Definition of Done

1. **Backend Integration Complete**: VideoProcessor successfully integrates with TrajectoryDebugger in debug mode
2. **Data Flow Established**: Debug data flows from processing through to UI availability
3. **Error Handling Robust**: Debug mode failures isolated and gracefully handled
4. **Performance Validated**: Debug mode overhead within acceptable limits
5. **Console Logging Enhanced**: Comprehensive debug information available when debug mode active
6. **Ready for Navigation**: Debug data and debugger instance prepared for dashboard presentation in Task 003

## Dependencies

**Requires Task 001**: Needs debug toggle UI to determine when debug mode should be activated
**Enables Task 003**: Provides debug data and debugger instance for dashboard navigation

## Technical Notes

- TrajectoryDebugger already exists and is fully functional
- Integration focuses on conditional initialization and data passing
- Existing video processing workflow should remain unchanged in normal mode
- Debug data structure designed for direct consumption by DebugDashboardView