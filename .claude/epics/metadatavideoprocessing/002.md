---
name: Implement MetadataStore Service
status: open
created: 2025-09-13T15:19:39Z
updated: 2025-09-13T15:19:39Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Implement MetadataStore Service

## Description
Create the MetadataStore service responsible for persisting ProcessingMetadata to JSON files in the app sandbox. This service will handle atomic writes, backup creation, and efficient file I/O operations while integrating with existing MediaStore patterns.

## Acceptance Criteria
- [ ] MetadataStore class with save, load, delete, and exists methods
- [ ] Atomic write operations to prevent corruption during saves
- [ ] Automatic backup creation before metadata updates
- [ ] File storage in `/ApplicationSupport/ProcessedMetadata/{video_id}.json`
- [ ] Error handling for file system operations with proper logging
- [ ] Integration with existing MediaStore delegate patterns

## Technical Details
- **Location**: `BumpSetCut/Data/Storage/MetadataStore.swift`
- **Implementation approach**:
  - Extend MediaStore patterns for consistency
  - Use FileManager for atomic writes with temporary files
  - UUID-based filename generation for video linking
- **Key considerations**:
  - Thread-safe operations for concurrent access
  - Graceful handling of storage permission issues
  - Consistent error types with existing MediaStore
- **Files affected**: New service in Data/Storage, integration with MediaStore

## Dependencies
- [ ] Task 001: ProcessingMetadata model must be complete
- [ ] Review MediaStore.swift for pattern consistency
- [ ] Validate app sandbox directory permissions

## Effort Estimate
- Size: M
- Hours: 12 hours
- Parallel: false (depends on model from Task 001)

## Definition of Done
- [ ] Service implemented with all CRUD operations
- [ ] Unit tests covering save/load/delete operations
- [ ] Integration tests with actual file system operations
- [ ] Error handling tested for permission and corruption scenarios
- [ ] Performance testing for typical metadata file sizes
- [ ] Code reviewed for MediaStore pattern consistency